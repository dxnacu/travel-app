{"ast":null,"code":"import { collection, getDocs, setDoc, doc, getDoc, addDoc, deleteDoc, updateDoc, Timestamp } from \"firebase/firestore\";\nimport { db } from \"./firebase\";\nexport async function getPlaces() {\n  const placesCol = collection(db, \"places\");\n  const placesSnapshot = await getDocs(placesCol);\n  console.log(\"Places: \", placesSnapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  })));\n  return placesSnapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n}\nexport const getPlaceById = async id => {\n  const docRef = doc(db, 'places', id);\n  const docSnap = await getDoc(docRef);\n  if (!docSnap.exists()) {\n    throw new Error('Place not found');\n  }\n  return {\n    ...docSnap.data(),\n    firebaseId: docSnap.id\n  };\n};\nexport const addTripToFirestore = async (uid, tripData) => {\n  const userTripsRef = collection(db, 'users', uid, 'trips');\n  const {\n    id: _discardedId,\n    ...cleanTripData\n  } = tripData;\n  const docRef = await addDoc(userTripsRef, {\n    ...cleanTripData,\n    status: 'planned'\n  });\n\n  // Optionally, update the document to include its own Firestore ID as a field\n  await setDoc(docRef, {\n    ...cleanTripData,\n    status: 'planned',\n    id: docRef.id\n  });\n  console.log(`Trip added with ID: ${docRef.id}`);\n  return {\n    ...cleanTripData,\n    id: docRef.id,\n    status: 'planned'\n  };\n};\nexport const getTripsFromFirestore = async uid => {\n  const tripsRef = collection(db, 'users', uid, 'trips');\n  const snapshot = await getDocs(tripsRef);\n  return snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n};\nexport const deleteTripFromFirestore = async (uid, tripid) => {\n  try {\n    const tripRef = doc(db, 'users', uid, 'trips', tripid);\n    await deleteDoc(tripRef);\n    console.log(`Trip \"${tripid}\" deleted from Firestore`);\n  } catch (error) {\n    console.error('Error deleting trip from Firestore:', error);\n  }\n};\nexport const markTripAsCompletedInFirestore = async (uid, tripid) => {\n  const tripRef = doc(db, 'users', uid, 'trips', tripid);\n  await updateDoc(tripRef, {\n    status: 'completed'\n  });\n};\nexport async function addUserToDatabase(user, role) {\n  try {\n    const userRef = doc(db, \"users\", user.uid);\n    const userSnap = await getDoc(userRef);\n    if (!userSnap.exists()) {\n      await setDoc(userRef, {\n        name: user.displayName || user.email.split('@')[0],\n        email: user.email,\n        createdAt: new Date()\n      });\n      console.log(\"User added to database: \", user.email);\n    } else {\n      console.log(\"User already exists in database: \", user.email);\n    }\n  } catch (error) {\n    console.error(\"Error adding user to database: \", error);\n    throw error;\n  }\n}\nexport const getReviewsForPlace = async id => {\n  const reviewsCol = collection(db, 'places', id, 'reviews');\n  const reviewsSnapshot = await getDocs(reviewsCol);\n  return reviewsSnapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n};\nexport const addReviewToPlace = async (placeId, reviewData) => {\n  console.log('addReviewToPlace called with:', {\n    placeId,\n    reviewData\n  });\n  const reviewsCol = collection(db, 'places', placeId, 'reviews');\n  console.log('Collection path:', reviewsCol.path);\n  const docRef = await addDoc(reviewsCol, {\n    ...reviewData,\n    createdAt: new Date()\n  });\n  console.log('Review added with ID:', docRef.id);\n  return {\n    id: docRef.id,\n    ...reviewData,\n    createdAt: new Date()\n  };\n};","map":{"version":3,"names":["collection","getDocs","setDoc","doc","getDoc","addDoc","deleteDoc","updateDoc","Timestamp","db","getPlaces","placesCol","placesSnapshot","console","log","docs","map","id","data","getPlaceById","docRef","docSnap","exists","Error","firebaseId","addTripToFirestore","uid","tripData","userTripsRef","_discardedId","cleanTripData","status","getTripsFromFirestore","tripsRef","snapshot","deleteTripFromFirestore","tripid","tripRef","error","markTripAsCompletedInFirestore","addUserToDatabase","user","role","userRef","userSnap","name","displayName","email","split","createdAt","Date","getReviewsForPlace","reviewsCol","reviewsSnapshot","addReviewToPlace","placeId","reviewData","path"],"sources":["C:/Users/Дана/WEB_CW/travel-app/client/src/services/databaseService.js"],"sourcesContent":["import { collection, getDocs, setDoc, doc, getDoc, addDoc, deleteDoc, updateDoc, Timestamp } from \"firebase/firestore\";\r\nimport { db } from \"./firebase\";\r\n\r\nexport async function getPlaces() {\r\n    const placesCol = collection(db, \"places\");\r\n    const placesSnapshot = await getDocs(placesCol);\r\n    console.log(\"Places: \", placesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n    return placesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n}\r\n\r\nexport const getPlaceById = async (id) => {\r\n    const docRef = doc(db, 'places', id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (!docSnap.exists()) {\r\n        throw new Error('Place not found');\r\n    }\r\n\r\n    return { ...docSnap.data(), firebaseId: docSnap.id };\r\n};\r\n\r\nexport const addTripToFirestore = async (uid, tripData) => {\r\n    const userTripsRef = collection(db, 'users', uid, 'trips');\r\n    const { id: _discardedId, ...cleanTripData } = tripData;\r\n\r\n    const docRef = await addDoc(userTripsRef, { ...cleanTripData, status: 'planned' });\r\n\r\n    // Optionally, update the document to include its own Firestore ID as a field\r\n    await setDoc(docRef, { ...cleanTripData, status: 'planned', id: docRef.id });\r\n\r\n    console.log(`Trip added with ID: ${docRef.id}`);\r\n\r\n    return { ...cleanTripData, id: docRef.id, status: 'planned' };\r\n};\r\n\r\nexport const getTripsFromFirestore = async (uid) => {\r\n    const tripsRef = collection(db, 'users', uid, 'trips');\r\n    const snapshot = await getDocs(tripsRef);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n};\r\n\r\nexport const deleteTripFromFirestore = async (uid, tripid) => {\r\n  try {\r\n    const tripRef = doc(db, 'users', uid, 'trips', tripid);\r\n    await deleteDoc(tripRef);\r\n    console.log(`Trip \"${tripid}\" deleted from Firestore`);\r\n  } catch (error) {\r\n    console.error('Error deleting trip from Firestore:', error);\r\n  }\r\n};\r\n\r\nexport const markTripAsCompletedInFirestore = async (uid, tripid) => {\r\n    const tripRef = doc(db, 'users', uid, 'trips', tripid);\r\n    await updateDoc(tripRef, { status: 'completed' });\r\n};\r\n\r\nexport async function addUserToDatabase(user, role) {\r\n    try {\r\n        const userRef = doc(db, \"users\", user.uid);\r\n        const userSnap = await getDoc(userRef);\r\n\r\n        if(!userSnap.exists()){\r\n            await setDoc(userRef, {\r\n                name: user.displayName || user.email.split('@')[0],\r\n                email: user.email,\r\n                createdAt: new Date()\r\n            });\r\n            console.log(\"User added to database: \", user.email);\r\n        } else {\r\n            console.log(\"User already exists in database: \", user.email);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error adding user to database: \", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport const getReviewsForPlace = async (id) => {\r\n    const reviewsCol = collection(db, 'places', id, 'reviews');\r\n    const reviewsSnapshot = await getDocs(reviewsCol);\r\n    return reviewsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n};\r\n\r\nexport const addReviewToPlace = async (placeId, reviewData) => {\r\n    console.log('addReviewToPlace called with:', { placeId, reviewData });\r\n    const reviewsCol = collection(db, 'places', placeId, 'reviews');\r\n    console.log('Collection path:', reviewsCol.path);\r\n    const docRef = await addDoc(reviewsCol, {\r\n        ...reviewData,\r\n        createdAt: new Date()\r\n    });\r\n    console.log('Review added with ID:', docRef.id);\r\n    return { id: docRef.id, ...reviewData, createdAt: new Date() };\r\n};"],"mappings":"AAAA,SAASA,UAAU,EAAEC,OAAO,EAAEC,MAAM,EAAEC,GAAG,EAAEC,MAAM,EAAEC,MAAM,EAAEC,SAAS,EAAEC,SAAS,EAAEC,SAAS,QAAQ,oBAAoB;AACtH,SAASC,EAAE,QAAQ,YAAY;AAE/B,OAAO,eAAeC,SAASA,CAAA,EAAG;EAC9B,MAAMC,SAAS,GAAGX,UAAU,CAACS,EAAE,EAAE,QAAQ,CAAC;EAC1C,MAAMG,cAAc,GAAG,MAAMX,OAAO,CAACU,SAAS,CAAC;EAC/CE,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEF,cAAc,CAACG,IAAI,CAACC,GAAG,CAACb,GAAG,KAAK;IAAEc,EAAE,EAAEd,GAAG,CAACc,EAAE;IAAE,GAAGd,GAAG,CAACe,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC,CAAC;EACxF,OAAON,cAAc,CAACG,IAAI,CAACC,GAAG,CAACb,GAAG,KAAK;IAAEc,EAAE,EAAEd,GAAG,CAACc,EAAE;IAAE,GAAGd,GAAG,CAACe,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AAC1E;AAEA,OAAO,MAAMC,YAAY,GAAG,MAAOF,EAAE,IAAK;EACtC,MAAMG,MAAM,GAAGjB,GAAG,CAACM,EAAE,EAAE,QAAQ,EAAEQ,EAAE,CAAC;EACpC,MAAMI,OAAO,GAAG,MAAMjB,MAAM,CAACgB,MAAM,CAAC;EAEpC,IAAI,CAACC,OAAO,CAACC,MAAM,CAAC,CAAC,EAAE;IACnB,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;EACtC;EAEA,OAAO;IAAE,GAAGF,OAAO,CAACH,IAAI,CAAC,CAAC;IAAEM,UAAU,EAAEH,OAAO,CAACJ;EAAG,CAAC;AACxD,CAAC;AAED,OAAO,MAAMQ,kBAAkB,GAAG,MAAAA,CAAOC,GAAG,EAAEC,QAAQ,KAAK;EACvD,MAAMC,YAAY,GAAG5B,UAAU,CAACS,EAAE,EAAE,OAAO,EAAEiB,GAAG,EAAE,OAAO,CAAC;EAC1D,MAAM;IAAET,EAAE,EAAEY,YAAY;IAAE,GAAGC;EAAc,CAAC,GAAGH,QAAQ;EAEvD,MAAMP,MAAM,GAAG,MAAMf,MAAM,CAACuB,YAAY,EAAE;IAAE,GAAGE,aAAa;IAAEC,MAAM,EAAE;EAAU,CAAC,CAAC;;EAElF;EACA,MAAM7B,MAAM,CAACkB,MAAM,EAAE;IAAE,GAAGU,aAAa;IAAEC,MAAM,EAAE,SAAS;IAAEd,EAAE,EAAEG,MAAM,CAACH;EAAG,CAAC,CAAC;EAE5EJ,OAAO,CAACC,GAAG,CAAC,uBAAuBM,MAAM,CAACH,EAAE,EAAE,CAAC;EAE/C,OAAO;IAAE,GAAGa,aAAa;IAAEb,EAAE,EAAEG,MAAM,CAACH,EAAE;IAAEc,MAAM,EAAE;EAAU,CAAC;AACjE,CAAC;AAED,OAAO,MAAMC,qBAAqB,GAAG,MAAON,GAAG,IAAK;EAChD,MAAMO,QAAQ,GAAGjC,UAAU,CAACS,EAAE,EAAE,OAAO,EAAEiB,GAAG,EAAE,OAAO,CAAC;EACtD,MAAMQ,QAAQ,GAAG,MAAMjC,OAAO,CAACgC,QAAQ,CAAC;EACxC,OAAOC,QAAQ,CAACnB,IAAI,CAACC,GAAG,CAACb,GAAG,KAAK;IAAEc,EAAE,EAAEd,GAAG,CAACc,EAAE;IAAE,GAAGd,GAAG,CAACe,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AACpE,CAAC;AAED,OAAO,MAAMiB,uBAAuB,GAAG,MAAAA,CAAOT,GAAG,EAAEU,MAAM,KAAK;EAC5D,IAAI;IACF,MAAMC,OAAO,GAAGlC,GAAG,CAACM,EAAE,EAAE,OAAO,EAAEiB,GAAG,EAAE,OAAO,EAAEU,MAAM,CAAC;IACtD,MAAM9B,SAAS,CAAC+B,OAAO,CAAC;IACxBxB,OAAO,CAACC,GAAG,CAAC,SAASsB,MAAM,0BAA0B,CAAC;EACxD,CAAC,CAAC,OAAOE,KAAK,EAAE;IACdzB,OAAO,CAACyB,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;EAC7D;AACF,CAAC;AAED,OAAO,MAAMC,8BAA8B,GAAG,MAAAA,CAAOb,GAAG,EAAEU,MAAM,KAAK;EACjE,MAAMC,OAAO,GAAGlC,GAAG,CAACM,EAAE,EAAE,OAAO,EAAEiB,GAAG,EAAE,OAAO,EAAEU,MAAM,CAAC;EACtD,MAAM7B,SAAS,CAAC8B,OAAO,EAAE;IAAEN,MAAM,EAAE;EAAY,CAAC,CAAC;AACrD,CAAC;AAED,OAAO,eAAeS,iBAAiBA,CAACC,IAAI,EAAEC,IAAI,EAAE;EAChD,IAAI;IACA,MAAMC,OAAO,GAAGxC,GAAG,CAACM,EAAE,EAAE,OAAO,EAAEgC,IAAI,CAACf,GAAG,CAAC;IAC1C,MAAMkB,QAAQ,GAAG,MAAMxC,MAAM,CAACuC,OAAO,CAAC;IAEtC,IAAG,CAACC,QAAQ,CAACtB,MAAM,CAAC,CAAC,EAAC;MAClB,MAAMpB,MAAM,CAACyC,OAAO,EAAE;QAClBE,IAAI,EAAEJ,IAAI,CAACK,WAAW,IAAIL,IAAI,CAACM,KAAK,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAClDD,KAAK,EAAEN,IAAI,CAACM,KAAK;QACjBE,SAAS,EAAE,IAAIC,IAAI,CAAC;MACxB,CAAC,CAAC;MACFrC,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAE2B,IAAI,CAACM,KAAK,CAAC;IACvD,CAAC,MAAM;MACHlC,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAE2B,IAAI,CAACM,KAAK,CAAC;IAChE;EACJ,CAAC,CAAC,OAAOT,KAAK,EAAE;IACZzB,OAAO,CAACyB,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;IACvD,MAAMA,KAAK;EACf;AACJ;AAEA,OAAO,MAAMa,kBAAkB,GAAG,MAAOlC,EAAE,IAAK;EAC5C,MAAMmC,UAAU,GAAGpD,UAAU,CAACS,EAAE,EAAE,QAAQ,EAAEQ,EAAE,EAAE,SAAS,CAAC;EAC1D,MAAMoC,eAAe,GAAG,MAAMpD,OAAO,CAACmD,UAAU,CAAC;EACjD,OAAOC,eAAe,CAACtC,IAAI,CAACC,GAAG,CAACb,GAAG,KAAK;IAAEc,EAAE,EAAEd,GAAG,CAACc,EAAE;IAAE,GAAGd,GAAG,CAACe,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AAC3E,CAAC;AAED,OAAO,MAAMoC,gBAAgB,GAAG,MAAAA,CAAOC,OAAO,EAAEC,UAAU,KAAK;EAC3D3C,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAE;IAAEyC,OAAO;IAAEC;EAAW,CAAC,CAAC;EACrE,MAAMJ,UAAU,GAAGpD,UAAU,CAACS,EAAE,EAAE,QAAQ,EAAE8C,OAAO,EAAE,SAAS,CAAC;EAC/D1C,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEsC,UAAU,CAACK,IAAI,CAAC;EAChD,MAAMrC,MAAM,GAAG,MAAMf,MAAM,CAAC+C,UAAU,EAAE;IACpC,GAAGI,UAAU;IACbP,SAAS,EAAE,IAAIC,IAAI,CAAC;EACxB,CAAC,CAAC;EACFrC,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEM,MAAM,CAACH,EAAE,CAAC;EAC/C,OAAO;IAAEA,EAAE,EAAEG,MAAM,CAACH,EAAE;IAAE,GAAGuC,UAAU;IAAEP,SAAS,EAAE,IAAIC,IAAI,CAAC;EAAE,CAAC;AAClE,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}